<?xml version="1.0" encoding="UTF-8"?>
<registry>
  <includes>
    <include>structs.xml</include>
  </includes>

  <handles>
    <handle name="Factory" doc="Class for creating adapters.
Can be safely destroyed after adapter has been chosen.">
      <file for="vk" include="vulkan/vk_factory.h"/>
      <file for="dx" include="dx12/dx12_factory.h"/>
    </handle>

    <handle name="Adapter" doc="Represents physical device.
Can safely be deleted once logical device has been created.">
      <file for="vk" include="vulkan/vk_adapter.h"/>
      <file for="dx" include="dx12/dx12_adapter.h"/>
    </handle>


    <handle name="Device" doc="Represents logical device.
Creates all the resources and commands for rendering.">
      <file for="vk" include="vulkan/vk_device.h"/>
      <file for="dx" include="dx12/dx12_device.h"/>
    </handle>


    <handle name="Fence"/>
    <handle name="ResourceAllocator"/>
    <handle name="RootSignature"/>
    <handle name="CommandQueue"/>
    <handle name="Shader"/>
    <handle name="PipelineState"/>
    <handle name="CommandList"/>
    <handle name="Buffer"/>
    <handle name="Texture"/>
    <handle name="SwapChain"/>
    <handle name="DebugMessenger"/>
    <handle name="RenderTarget"/>
    <handle name="DescriptorBuffer"/>
    <handle name="Sampler"/>
    <handle name="Memory"/>
    <handle name="ShaderResource"/>
    <handle name="FactoryExtension"/>
    <handle name="DeviceExtension"/>
  </handles>

  <functions>
    <!-- Factory -->
    <func for="Factory" name="Destroy" mod="custom-impl" doc="Destroys the {Factory::} and all the extensions created by it.
Order of destruction is Extensions in which they were created, then factory."/>

    <func for="Factory" name="GetAdapter" doc="Creates the {Adapter::} for the factory with provided index.">
      <ret type="Adapter" name="adapter" result="true" doc="{Adapter::} on success ({Status::Ok})."/>
      <arg type="u32" name="index" doc="The index of the adapter to get."/>
      <arg type="AdapterPreference" name="preference" default="wis::AdapterPreference::Performance" doc="The preference of the adapter to get.
Default is {AdapterPreference::Performance}."/>
    </func>

    <!-- Adapter -->
    <func for="Adapter" name="Destroy" doc="Destroys the {Adapter::}."/>

    <func for="Adapter" name="GetDesc" doc="Fills {AdapterDesc::} with physical adapter's data.">
      <ret result="true"/>
      <arg type="AdapterDesc" name="inout_desc" mod="ptr" doc="The {AdapterDesc::} to fill.
Must not be NULL."/>
    </func>

    <!-- Device -->
    <func for="Device" name="Destroy" mod="custom-impl" doc="Destroys the {Device::} and all the extensions created by it.
Order of destruction is Extensions in which they were created, then device."/>

    <func for="Device" name="WaitForMultipleFences" doc="Waits on multiple fences simultaneously.
If wait_all is {MutiWaitFlags::All}, waits for all fences to be signaled.
Otherwise waits for any fence to be signaled.">
      <ret result="true"/>
      <arg type="FenceView" name="fences" mod="const ptr" doc="Array of fence views to wait on."/>
      <arg type="u64" name="fence_values" mod="const ptr" doc="Fence values to wait fences to reach.
Array must have fence_count values."/>
      <arg type="u32" name="fence_count" doc="How many fences to wait on."/>
      <arg type="MutiWaitFlags" name="wait_all" default="MutiWaitFlags::All" doc="Specifies the kind of wait. 
All - waits for all fences to be signaled.
Any - waits for any fence to be signaled.
Default is {MutiWaitFlags::All}"/>
      <arg type="u64" name="timeout" default="UINT64_MAX" doc="The timeout in nanoseconds. If UINT64_MAX, waits indefinitely."/>
    </func>
    
    <!--<func for="Fence" name="Destroy"/>
    <func for="ResourceAllocator" name="Destroy"/>
    <func for="RootSignature" name="Destroy"/>
    <func for="CommandQueue" name="Destroy"/>
    <func for="Shader" name="Destroy"/>
    <func for="PipelineState" name="Destroy"/>
    <func for="CommandList" name="Destroy"/>
    <func for="Buffer" name="Destroy"/>
    <func for="Texture" name="Destroy"/>
    <func for="SwapChain" name="Destroy"/>
    <func for="DebugMessenger" name="Destroy"/>
    <func for="RenderTarget" name="Destroy"/>
    <func for="DescriptorBuffer" name="Destroy"/>
    <func for="Sampler" name="Destroy"/>
    <func for="Memory" name="Destroy"/>
    <func for="ShaderResource" name="Destroy"/>-->

    <!-- Free Functions -->
    <func name="CreateFactory" mod="custom-impl" doc="Creates the {Factory::} with extensions, specified in extension array.">
      <ret type="Factory" name="factory" result="true" doc="{Factory::} on success ({Status::Ok})."/>
      <arg type="bool" name="debug_layer" default="false" doc="Enable the debug layer for underlying API."/>
      <arg type="FactoryExtension" name="extensions" mod="pp" default="nullptr" doc="The extensions to enable.
The extensions are initialized through this array.">
        <replace with="FactoryExtQuery" for="c" mod="ptr" default="nullptr" doc="Query the extensions that need to be present.
The extension pointers are initialized if the extension is found and initialized.
Otherwise returns NULL."/>
      </arg>
      <arg type="u32" name="extension_count" default="0" doc="The number of extensions to enable."/>
    </func>

    <func name="CreateDevice" mod="custom-impl" doc="Creates the {Device::} with extensions, specified in extension array.">
      <ret type="Device" name="device" result="true" doc="{Device::} on success ({Status::Ok})."/>
      <arg type="Adapter" name="adapter" doc="The adapter to create the logical device on. Must not be NULL."/>
      <arg type="DeviceExtension" name="extensions" mod="pp" default="nullptr" doc="The extensions to enable.
The extensions are initialized through this array.">
        <replace with="DeviceExtQuery" for="c" mod="ptr" default="nullptr" doc="Query the extensions that need to be present.
The extension pointers are initialized if the extension is found and initialized.
Otherwise returns NULL."/>
      </arg>
      <arg type="u32" name="extension_count" default="0" doc="The number of extensions to enable."/>
      <arg type="bool" name="force" default="false" doc="Create logical device even if some core functionality is absent.
The presence of core functionality is checked by the query function."/>
    </func>


  </functions>
  <extensions>
    <ext name="DebugExtension" type="Factory" id="1" folder="debug_info">
      <file include="wisdom/wisdom_debug.h"/>
      <func for="DebugExtension" name="CreateDebugMessenger" doc="Creates a debug messenger for the factory.">
        <ret type="DebugMessenger" name="messenger" result="true" doc="{DebugMessenger::} on success ({Status::Ok})."/>
        <arg type="DebugCallback" name="callback" doc="The callback that will receive the debug messages."/>
        <arg type="void" name="user_data" mod="ptr" doc="The user data that will be passed to the callback."/>"
      </func>
    </ext>
  </extensions>
</registry>
